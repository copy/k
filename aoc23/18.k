c:(0 1;1 0;0 -1;-1 0)
i:{{((c"RDLU"?*x;.y;c@16!z;-16!z:16/39!-48+z))}." "\x^"()#"}'0:"i/18"

f:{
 m:-1_0 0{x+*/y}\0,x

 m:m{$[**y;(1 0;-1 0);0]+x@<x:(x;x+*/2#y)}'x

 hor:+m[;;0]
 ver:m[;;1]

 h:h@<h:?,/0 1+hor
 s:{1_{(y[1]+1;x[0]-1)}':x@<x}'ver@&'(h<\:hor[1]+1)&hor[0]</:h+1

 h:|1,|1_{x-y}':h

 s2:{
  :y{
   $[~#x;:x;]
   :x@&{0|/{-1<-/|(x[0]|y[0];x[1]&y[1])}[x]'y}[;y]'x
  }'x,'(():':x),'|():':|x
 }[;s]/(~!#s)#'s

 +/x[;1],/h*{1+y-x}.''s2}

f@i[;0 1]
f@i[;2 3]
